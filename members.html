<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Members - SUNYANI MUNICIPAL WELFARE</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="app-header">
      <div class="header-content">
        <h1>üåÖ SUNYANI MUNICIPAL WELFARE</h1>
        <div class="header-actions">
          <span class="welcome-msg">Welcome, Admin</span>
          <button onclick="location.href='dashboard.html'" class="logout-btn">‚Üê Dashboard</button>
        </div>
      </div>
    </header>

    <!-- Navigation -->
    <nav class="main-nav">
      <a href="dashboard.html" class="nav-link">üè† Dashboard</a>
      <a href="members.html" class="nav-link active">üë• Members</a>
      <a href="contributions.html" class="nav-link">üí∞ Contributions</a>
      <a href="withdrawals.html" class="nav-link">üèß Withdrawals</a>
      <a href="reports.html" class="nav-link">üìä Reports</a>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <div class="page-header">
        <h2>Member Management</h2>
        <p>Manage all welfare scheme members and their contributions</p>
        <button class="btn-primary" onclick="showAddMemberModal()">‚ûï Add New Member</button>
      </div>

      <!-- Members Table -->
      <div class="table-container">
        <table class="data-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Full Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Monthly Contribution</th>
              <th>Join Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="membersTableBody">
            <tr>
              <td colspan="7" class="loading-text">Loading members...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </main>
  </div>

  <!-- Add Member Modal -->
  <div id="addMemberModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add New Member</h3>
        <button class="close-btn" onclick="closeAddMemberModal()">&times;</button>
      </div>
      <form id="addMemberForm">
        <div class="form-group">
          <label for="memberName">Full Name *</label>
          <input type="text" id="memberName" required />
        </div>
        <div class="form-group">
          <label for="memberEmail">Email</label>
          <input type="email" id="memberEmail" />
        </div>
        <div class="form-group">
          <label for="memberPhone">Phone Number</label>
          <input type="tel" id="memberPhone" />
        </div>
        <div class="form-group">
          <label for="monthlyContribution">Monthly Contribution (GH‚Çµ) *</label>
          <input type="number" id="monthlyContribution" min="0" step="0.01" required />
        </div>
        <div class="form-actions">
          <button type="button" class="btn-secondary" onclick="closeAddMemberModal()">Cancel</button>
          <button type="submit" class="btn-primary">Add Member</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Firebase & Script -->
  <script type="module">
    import { app } from "./js/firebase.js";
    import {
      getDatabase,
      ref,
      push,
      set,
      onValue,
      serverTimestamp,
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const db = getDatabase(app);
    const membersTableBody = document.getElementById("membersTableBody");
    const form = document.getElementById("addMemberForm");

    // Load members live
    const membersRef = ref(db, "members");
    onValue(membersRef, (snapshot) => {
      const data = snapshot.val();
      if (!data) {
        membersTableBody.innerHTML =
          "<tr><td colspan='7'>No members found</td></tr>";
        return;
      }

      membersTableBody.innerHTML = Object.keys(data)
        .map((id) => {
          const m = data[id];
          return `
            <tr>
              <td>${id}</td>
              <td>${m.fullName}</td>
              <td>${m.email || "-"}</td>
              <td>${m.phone || "-"}</td>
              <td>‚Çµ ${Number(m.monthlyContribution || 0).toFixed(2)}</td>
              <td>${m.joinDate || "-"}</td>
              <td><span class="status-badge status-active">Active</span></td>
            </tr>
          `;
        })
        .join("");
    });

    // Add new member
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const fullName = document.getElementById("memberName").value.trim();
      const email = document.getElementById("memberEmail").value.trim();
      const phone = document.getElementById("memberPhone").value.trim();
      const monthlyContribution = document.getElementById(
        "monthlyContribution"
      ).value;

      if (!fullName || !monthlyContribution) {
        alert("‚ö† Please fill all required fields!");
        return;
      }

      const newMemberRef = push(ref(db, "members"));
      set(newMemberRef, {
        fullName,
        email,
        phone,
        monthlyContribution: Number(monthlyContribution),
        joinDate: new Date().toLocaleDateString(),
        status: "Active",
        timestamp: serverTimestamp(),
      })
        .then(() => {
          alert("‚úÖ Member added successfully!");
          form.reset();
          closeAddMemberModal();
        })
        .catch((err) => {
          alert("‚ùå Error saving member: " + err.message);
        });
    });
  </script>

  <script>
    // Modal functions
    function showAddMemberModal() {
      document.getElementById("addMemberModal").style.display = "block";
    }

    function closeAddMemberModal() {
      document.getElementById("addMemberModal").style.display = "none";
      document.getElementById("addMemberForm").reset();
    }

    window.onclick = function (event) {
      const modal = document.getElementById("addMemberModal");
      if (event.target === modal) {
        closeAddMemberModal();
      }
    };
  </script>
</body>
</html>
